webpackJsonp([1],{"4+hh":function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),i=n("pFYg"),o=n.n(i);window.JSLog=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if("to"===e)n.forEach(function(e){var t="",n=[],a=0;for(var i in e)0!==a&&(t+="JSLog: "),a++,t+=i+" : "+e[i]+" \n","object"===o()(e[i])&&n.push({name:i,o:e[i]});JSLog(t),n.forEach(function(e){JSLog("-> "+e.name),JSLog("to",e.o)})});else{var i=Array.prototype.slice.call(arguments);window.console&&console.log("JSLog: "+i.join(" | "))}};var l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var s=n("VU/8")({name:"App"},l,!1,function(e){n("UDJb")},null,null).exports,r=n("/ocq"),c=n("fZjL"),u=n.n(c),d=n("Zrlr"),m=n.n(d),p=n("wxAW"),f=n.n(p),y=n("BO1k"),v=n.n(y),h=n("NYxO"),b={MySQL:[{name:"BIT",type:"Number"},{name:"TINYINT",type:"Number"},{name:"BOOL",type:"Number"},{name:"BOOLEAN",type:"Number"},{name:"SMALLINT",type:"Number"},{name:"MEDIUMINT",type:"Number"},{name:"INT",type:"Number"},{name:"INTEGER",type:"Number"},{name:"BIGINT",type:"Number"},{name:"DECIMAL",type:"Number"},{name:"DEC",type:"Number"},{name:"FLOAT",type:"Number"},{name:"DOUBLE",type:"Number"},{name:"DATE",type:"Date"},{name:"DATETIME",type:"Date"},{name:"TIMESTAMP",type:"Date"},{name:"TIME",type:"Date"},{name:"YEAR(4)",type:"Date"},{name:"CHAR",type:"String"},{name:"VARCHAR",type:"String"},{name:"BINARY",type:"String"},{name:"VARBINARY",type:"String"},{name:"TINYBLOB",type:"String"},{name:"TINYTEXT",type:"String"},{name:"BLOB",type:"String"},{name:"TEXT",type:"String"},{name:"MEDIUMBLOB",type:"String"},{name:"MEDIUMTEXT",type:"String"},{name:"LONGBLOB",type:"String"},{name:"LONGTEXT",type:"String"},{name:"ENUM",type:"String"},{name:"SET",type:"String"}],Oracle:[]},g=function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return[e(),e(),"-",e(),"-",e(),"-",e(),"-",e(),e(),e()].join("")},T=function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,l=v()(e);!(n=(o=l.next()).done);n=!0){var s=o.value;if(t===s.id)return s}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}},C=function(e){var t=0;return $(e).each(function(){var e=Number($(this).css("z-index"));t<e&&(t=e)}),++t},k=function(){$(this).css("z-index",C(".erd_table"))},w=function(e){$(e.target).closest(".data_type_list").length||E.commit({type:"dataTypeHintVisibleAll",isDataTypeHint:!1})};a.default.use(h.a);var E=new h.a.Store({state:{DBType:"MySQL",tables:[],lines:[]},mutations:{addTable:function(e){e.tables.push({id:g(),name:null,comment:null,columns:[],ui:{selected:!1,top:document.documentElement.scrollTop+100,left:document.documentElement.scrollLeft+200,width:692,height:88}})},deleteTable:function(e,t){for(var n in e.tables)if(t.id===e.tables[n].id){e.tables.splice(n,1);break}for(var a=0;a<e.lines.length;a++){var i=!1;for(var o in e.lines[a].points)if(t.id===e.lines[a].points[o].id){i=!0;break}i&&(this.commit({type:"deleteLine",id:e.lines[a].id}),a--)}},addColumn:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,l=v()(e.tables);!(n=(o=l.next()).done);n=!0){var s=o.value;if(t.id===s.id){s.ui.height+=25,s.columns.push({id:g(),name:null,comment:null,dataType:null,isNull:!0,ui:{selected:!1,key:{pk:!1,fk:!1,pfk:!1},isDataTypeHint:!1,dataTypes:b.MySQL}});break}}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}},deleteColumn:function(e,t){var n=T(e.tables,t.tableId);for(var a in n.columns)if(t.columnId===n.columns[a].id){n.columns.splice(a,1),n.ui.height-=25;break}},changeNull:function(e,t){var n=T(e.tables,t.tableId),a=T(n.columns,t.columnId);a.isNull=!a.isNull},changeDB:function(e,t){e.DBType=t.DBType;var n=!0,a=!1,i=void 0;try{for(var o,l=v()(e.tables);!(n=(o=l.next()).done);n=!0){var s=o.value,r=!0,c=!1,u=void 0;try{for(var d,m=v()(s.columns);!(r=(d=m.next()).done);r=!0){d.value.ui.dataTypes=b[t.DBType]}}catch(e){c=!0,u=e}finally{try{!r&&m.return&&m.return()}finally{if(c)throw u}}}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}},tableHeightReset:function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=v()(e.tables);!(t=(i=o.next()).done);t=!0){var l=i.value;l.ui.height=25*l.columns.length+88}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}},tableSelected:function(e,t){if(e.tables.forEach(function(e){e.ui.selected=t.id===e.id}),t.onlyTableSelected&&I(e),S.core.event.isCursor&&!S.core.event.isDraw){var n=T(e.tables,t.id),a=g();e.lines.push({id:a,points:[{id:t.id,x:n.ui.left,y:n.ui.top},{id:null,x:n.ui.left,y:n.ui.top}]}),S.core.event.startCursor(a)}else if(S.core.event.isDraw){var i=T(e.lines,S.core.event.lineId);t.id!==i.points[0].id&&S.core.event.endCursor(t.id)}},columnSelected:function(e,t){I(e);var n=T(e.tables,t.tableId),a=T(n.columns,t.columnId);a&&(a.ui.selected=!0)},columnKey:function(e,t){switch(t.key){case"pk":!function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,l=v()(e.tables);!(n=(o=l.next()).done);n=!0){var s=o.value,r=!1,c=!0,u=!1,d=void 0;try{for(var m,p=v()(s.columns);!(c=(m=p.next()).done);c=!0){var f=m.value;if(f.ui.selected){f.ui.key[t]=!f.ui.key[t],r=!0;break}}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}if(r)break}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}}(e,t.key)}},changeColumnDataType:function(e,t){var n=T(e.tables,t.tableId);T(n.columns,t.columnId).dataType=t.dataType},dataTypeHintVisible:function(e,t){var n=T(e.tables,t.tableId);T(n.columns,t.columnId).ui.isDataTypeHint=t.isDataTypeHint},dataTypeHintVisibleAll:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,l=v()(e.tables);!(n=(o=l.next()).done);n=!0){var s=o.value,r=!0,c=!1,u=void 0;try{for(var d,m=v()(s.columns);!(r=(d=m.next()).done);r=!0){d.value.ui.isDataTypeHint=t.isDataTypeHint}}catch(e){c=!0,u=e}finally{try{!r&&m.return&&m.return()}finally{if(c)throw u}}}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}},changeDataTypeHint:function(e,t){var n=T(e.tables,t.tableId);T(n.columns,t.columnId).ui.dataTypes=function(e){for(var t=E.state.DBType,n=b[t].slice(),a=0;a<n.length;a++){var i=!0;-1!==n[a].name.toLowerCase().indexOf(e.toLowerCase())&&(i=!1),i&&(n.splice(a,1),a--)}return n}(t.key)},tableTracker:function(e,t){var n=T(e.tables,t.id);n.ui.top=t.top,n.ui.left=t.left,e.lines.forEach(function(e){e.points.forEach(function(e){e.id===t.id&&(e.x=t.left,e.y=t.top)})})},lineDraw:function(e,t){var n=T(e.lines,t.id);n.points[1].x=t.x,n.points[1].y=t.y,t.tableId&&(n.points[1].id=t.tableId)},deleteLine:function(e,t){for(var n in e.lines)if(t.id===e.lines[n].id){e.lines.splice(n,1);break}}}});function I(e){e.tables.forEach(function(e){e.columns.forEach(function(e){e.ui.selected=!1})})}var L=new(function(){function e(){m()(this,e),JSLog("Class Event"),this.core=null,this.rightClickListener=[],this.isCursor=!1,this.isDraw=!1,this.eventTarget=null,this.lineId=null,this.setEvent()}return f()(e,[{key:"init",value:function(e){JSLog("Class Event init"),this.core=e}},{key:"setEvent",value:function(){window.addEventListener("contextmenu",function(e){e.preventDefault(),this.core.event.onRightClick(e)}.bind(this))}},{key:"addRightClick",value:function(e,t){this.rightClickListener.push({fn:e,id:t})}},{key:"removeRightClick",value:function(e){for(var t in this.rightClickListener)if(e===this.rightClickListener[t].id){this.rightClickListener.splice(t,1);break}}},{key:"onRightClick",value:function(e){JSLog("initialize","onRightClick"),JSLog("to",this.rightClickListener),this.rightClickListener.forEach(function(t){"function"==typeof t.fn&&t.fn(e)})}},{key:"cursor",value:function(e){e?($("body").css("cursor",'url("/static/images/erd/'+e+'.png") 16 16, auto'),this.isCursor=!0):($("body").removeAttr("style"),this.isCursor=!1,this.isDraw&&this.endCursor())}},{key:"startCursor",value:function(e){this.lineId=e,this.eventTarget=this.mouseMove.bind({id:e}),$(document).mousemove(this.eventTarget),this.isDraw=!0}},{key:"endCursor",value:function(e){if($(document).off("mousemove",this.eventTarget),this.isDraw=!1,e){var t=T(E.state.tables,e);E.commit({type:"lineDraw",id:this.lineId,x:t.ui.left,y:t.ui.top,tableId:e}),this.cursor()}else E.commit({type:"deleteLine",id:this.lineId});this.lineId=null}},{key:"mouseMove",value:function(e){E.commit({type:"lineDraw",id:this.id,x:e.clientX+document.documentElement.scrollLeft,y:e.clientY+document.documentElement.scrollTop})}}]),e}()),S=new(function(){function e(){m()(this,e),JSLog("Class ERD"),this.core={event:L},this.setInit(this.core)}return f()(e,[{key:"setInit",value:function(e){JSLog("Class ERD Init"),u()(e).forEach(function(t){e[t].init(e)})}}]),e}()),_={name:"TableMenu",data:function(){return{menus:[{type:"pk",icon:"",name:"PK",keymap:""},{type:"erd-0-1-N",icon:"/static/images/erd/erd-0-1-N.png",name:"비식별관계",keymap:""}]}},methods:{menuAction:function(e){switch(e){case"pk":E.commit({type:"columnKey",key:e});break;case"erd-0-1-N":S.core.event.isCursor?S.core.event.cursor():S.core.event.cursor(e)}}},mounted:function(){S.core.event.addRightClick(function(e){var t=$(this);t.css({top:e.clientY+"px",left:e.clientX+"px","z-index":C(".erd_table")}),t.show()}.bind(this.$el)),$(document).on("mousedown",function(e){var t=$(this),n=t.offset();n.top-=document.documentElement.scrollTop,n.left-=document.documentElement.scrollLeft,n.width=t.width(),n.height=t.height(),n.top<=e.clientY&&e.clientY<=n.top+n.height&&n.left<=e.clientX&&e.clientX<=n.left+n.width||t.hide()}.bind(this.$el))}},D={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"menuTable"},e._l(e.menus,function(t){return n("li",{key:t.id,on:{click:function(n){e.menuAction(t.type)}}},[n("span",[""!==t.icon?n("img",{attrs:{src:t.icon}}):n("span")]),n("span",[e._v(e._s(t.name))]),n("span",[e._v(e._s(t.keymap))])])}))},staticRenderFns:[]};var x=n("VU/8")(_,D,!1,function(e){n("TP/I")},"data-v-1ef67e72",null).exports,N=void 0,M=void 0,R=void 0,B=void 0,H=void 0,A=void 0,J=void 0,O=void 0;function V(){requestAnimationFrame(V),A.rotation.x+=.02,A.rotation.y+=.02,R.render(M,N)}var U=function(){(R=new THREE.WebGLRenderer({canvas:document.getElementById("menu_canvas"),antialias:!0})).setClearColor(2631720),N=new THREE.PerspectiveCamera(10,1,.1,3e3),M=new THREE.Scene,J=new THREE.AmbientLight(16777215,.5),M.add(J),O=new THREE.PointLight(16777215,.5),M.add(O),B=new THREE.IcosahedronBufferGeometry(85,1),H=new THREE.MeshLambertMaterial({color:4365747}),(A=new THREE.Mesh(B,H)).position.set(0,0,-1e3),M.add(A),V()},P={name:"CanvasMenu",data:function(){return{DBTypes:["MySQL","Oracle"],menuCheck:!1}},methods:{addTable:function(){JSLog("CanvasMenu","addTable"),E.commit({type:"addTable"})},selectDB:function(e){JSLog("CanvasMenu","selectDB"),E.commit({type:"changeDB",DBType:e.target.value})},menu:function(){this.menuCheck=!this.menuCheck}},mounted:function(){U()}},Y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"menuCanvas"},[n("canvas",{attrs:{id:"menu_canvas"},on:{click:e.menu}}),e.menuCheck?n("select",{staticClass:"dbType",on:{change:e.selectDB}},e._l(e.DBTypes,function(t){return n("option",{domProps:{value:t}},[e._v(e._s(t))])})):e._e(),e.menuCheck?n("button",{staticClass:"addTable btn btn-primary",on:{click:e.addTable}},[n("font-awesome-icon",{attrs:{icon:"table"}})],1):e._e()])},staticRenderFns:[]};var X=n("VU/8")(P,Y,!1,function(e){n("fXpJ")},"data-v-93411438",null).exports,q=n("DAYN"),F={name:"CanvasMain",components:{draggable:n.n(q).a},data:function(){return{tables:E.state.tables,onlyTableSelected:!0}},methods:{addColumn:function(e){JSLog("CanvasMain","addColumn",e),E.commit({type:"addColumn",id:e})},deleteColumn:function(e,t){JSLog("CanvasMain","deleteColumn",e,t),E.commit({type:"deleteColumn",tableId:e,columnId:t})},changeNull:function(e,t){E.commit({type:"changeNull",tableId:e,columnId:t})},deleteTable:function(e){JSLog("CanvasMain","deleteTable",e),E.commit({type:"deleteTable",id:e})},tableSelected:function(e){JSLog("CanvasMain","tableSelected",e),E.commit({type:"tableSelected",id:e,onlyTableSelected:this.onlyTableSelected}),this.onlyTableSelected=!0},columnSelected:function(e,t){JSLog("CanvasMain","columnSelected",e,t),E.commit({type:"columnSelected",tableId:e,columnId:t}),this.onlyTableSelected=!1},dataTypeHintVisible:function(e,t,n,a){E.commit({type:"dataTypeHintVisible",tableId:t,columnId:n,isDataTypeHint:a});var i=$(e.target).parent("div").find("li"),o=i.filter(".selected").index(),l=i.length;38===e.keyCode?-1===o?i.eq(l-1).addClass("selected"):(i.eq(o).removeClass("selected"),i.eq(o-1).addClass("selected")):40===e.keyCode?-1===o?i.eq(0).addClass("selected"):(i.eq(o).removeClass("selected"),i.eq(o+1===l?0:o+1).addClass("selected")):13===e.keyCode?-1!==o&&E.commit({type:"changeColumnDataType",tableId:t,columnId:n,dataType:i.filter(".selected").text()}):a&&E.commit({type:"changeDataTypeHint",tableId:t,columnId:n,key:e.target.value})},changeColumnDataType:function(e,t,n,a){JSLog("changeColumnDataType",t,n,a),E.commit({type:"changeColumnDataType",tableId:t,columnId:n,dataType:a}),$(e.target).parents("div").find(".erd_data_type").focus()},dataTypeHintAddClass:function(e){$(e.target).parent("ul").find("li").removeClass("selected"),$(e.target).addClass("selected")},draggableEnd:function(){E.commit({type:"tableHeightReset"})}},updated:function(){$(".erd_table").draggable({drag:function(e,t){E.commit({type:"tableTracker",id:$(this).attr("table_id"),top:t.offset.top,left:t.offset.left})}}).off("mousedown",k).mousedown(k),$(document).off("mousedown",w).on("mousedown",w)}},Q={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition-group",{attrs:{id:"main_canvas",name:"slide-fade",tag:"div"}},e._l(e.tables,function(t){return n("div",{key:t.id,staticClass:"erd_table",class:{selected:t.ui.selected},style:"top: "+t.ui.top+"px; left: "+t.ui.left+"px;",attrs:{table_id:t.id},on:{mousedown:function(n){e.tableSelected(t.id)}}},[n("div",{staticClass:"erd_table_top"}),n("div",{staticClass:"erd_table_header"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"table.name"}],attrs:{type:"text",placeholder:"table"},domProps:{value:t.name},on:{input:function(n){n.target.composing||e.$set(t,"name",n.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"table.comment"}],attrs:{type:"text",placeholder:"comment"},domProps:{value:t.comment},on:{input:function(n){n.target.composing||e.$set(t,"comment",n.target.value)}}}),n("button",{staticClass:"btn btn-outline-primary",on:{click:function(n){e.addColumn(t.id)}}},[n("font-awesome-icon",{attrs:{icon:"plus"}})],1),n("button",{staticClass:"btn btn-outline-danger",on:{click:function(n){e.deleteTable(t.id)}}},[n("font-awesome-icon",{attrs:{icon:"times"}})],1)]),n("draggable",{attrs:{options:{group:"table"}},on:{end:e.draggableEnd},model:{value:t.columns,callback:function(n){e.$set(t,"columns",n)},expression:"table.columns"}},[n("transition-group",{attrs:{name:"slide-fade",tag:"div"}},e._l(t.columns,function(a){return n("div",{key:a.id,staticClass:"erd_column",class:{selected:a.ui.selected},on:{mousedown:function(n){e.columnSelected(t.id,a.id)}}},[n("div",{staticClass:"erd_column_key",class:{pk:a.ui.key.pk,fk:a.ui.key.fk,pfk:a.ui.key.pfk}},[n("font-awesome-icon",{attrs:{icon:"key"}})],1),n("input",{directives:[{name:"model",rawName:"v-model",value:a.name,expression:"column.name"}],attrs:{type:"text",placeholder:"column"},domProps:{value:a.name},on:{input:function(t){t.target.composing||e.$set(a,"name",t.target.value)}}}),n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:a.dataType,expression:"column.dataType"}],staticClass:"erd_data_type",attrs:{type:"text",placeholder:"dataType"},domProps:{value:a.dataType},on:{keyup:function(n){e.dataTypeHintVisible(n,t.id,a.id,!0)},input:function(t){t.target.composing||e.$set(a,"dataType",t.target.value)}}}),a.ui.isDataTypeHint?n("ul",{staticClass:"erd_data_type_list"},e._l(a.ui.dataTypes,function(i){return n("li",{on:{click:function(n){e.changeColumnDataType(n,t.id,a.id,i.name)},mouseover:e.dataTypeHintAddClass}},[e._v(e._s(i.name))])})):e._e()]),a.isNull?n("input",{staticClass:"erd_column_not_null",attrs:{type:"text",readonly:"readonly",value:"NULL"},on:{click:function(n){e.changeNull(t.id,a.id)}}}):n("input",{staticClass:"erd_column_not_null",attrs:{type:"text",readonly:"readonly",value:"N-N"},on:{click:function(n){e.changeNull(t.id,a.id)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:a.comment,expression:"column.comment"}],attrs:{type:"text",placeholder:"comment"},domProps:{value:a.comment},on:{input:function(t){t.target.composing||e.$set(a,"comment",t.target.value)}}}),n("button",{staticClass:"btn",on:{click:function(n){e.deleteColumn(t.id,a.id)}}},[n("font-awesome-icon",{attrs:{icon:"times"}})],1)])}))],1)],1)}))},staticRenderFns:[]};var W={name:"CanvasSvg",data:function(){return{lines:E.state.lines}},computed:{toLines:function(){var e=[];return this.lines.forEach(function(t){e.push({id:t.id,points:function(e){var t=T(E.state.tables,e.points[0].id),n=T(E.state.tables,e.points[1].id);n?JSLog("to",t.ui,n.ui):JSLog("to",t.ui);var a=[];return a.push("M"+e.points[0].x+" "+e.points[0].y),a.push("Q "+(e.points[0].x+e.points[1].x)/2+" "+e.points[0].y),a.push(e.points[1].x+" "+e.points[1].y),a.join(" ")}(t)})}),e}}},j={render:function(){var e=this.$createElement,t=this._self._c||e;return t("svg",{attrs:{id:"svg_canvas"}},this._l(this.toLines,function(e){return t("path",{staticClass:"test",attrs:{d:e.points,"stroke-dasharray":"10,10","stroke-width":"3",stroke:"#dda8b1",fill:"transparent"}})}))},staticRenderFns:[]};var G={name:"ERD",components:{TableMenu:x,CanvasMenu:X,CanvasMain:n("VU/8")(F,Q,!1,function(e){n("s30Q")},"data-v-ddeb510c",null).exports,CanvasSvg:n("VU/8")(W,j,!1,function(e){n("VxtX")},"data-v-627e8048",null).exports}},z={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"erd"}},[t("table-menu"),t("canvas-menu"),t("canvas-main"),t("canvas-svg")],1)},staticRenderFns:[]};var K=n("VU/8")(G,z,!1,function(e){n("kOJW")},null,null).exports;a.default.use(r.a);var Z=new r.a({mode:"history",routes:[{path:"/",name:"ERD",component:K}]});a.default.use(h.a);var ee=new h.a.Store({state:{},mutations:{}}),te=n("mtWM"),ne=n.n(te),ae=n("EqLo"),ie=(n("4+hh"),n("giDI"),n("qb6w"),n("C/JF")),oe=n("fhbW"),le=n("U0v6");a.default.config.productionTip=!1,a.default.prototype.$http=ne.a,a.default.prototype.$event=new a.default,a.default.use(ae.MdButton),ie.library.add(oe.c,oe.b,oe.d,oe.a),a.default.component("font-awesome-icon",le.FontAwesomeIcon),new a.default({el:"#app",router:Z,store:ee,components:{App:s},template:"<App/>"})},"TP/I":function(e,t){},UDJb:function(e,t){},VxtX:function(e,t){},fXpJ:function(e,t){},giDI:function(e,t){},kOJW:function(e,t){},qb6w:function(e,t){},s30Q:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.83524cdee08f8bcaaf5c.js.map